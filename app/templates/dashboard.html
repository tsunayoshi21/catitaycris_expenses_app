{% extends 'base.html' %}
{% block title %}Dashboard - Finanzas{% endblock %}

{% block head %}
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    /* Igualar tamaño/altura de gráficos y mejorar estética */
    .chart-container { position: relative; height: 360px; }
    @media (min-width: 1400px){ .chart-container { height: 420px; } }
  </style>
{% endblock %}

{% block content %}
  <div class="row g-3 align-items-end mb-3">
    <div class="col-6 col-md-2">
      <label class="form-label">Año</label>
      <input id="year" type="number" class="form-control" placeholder="YYYY">
    </div>
    <div class="col-6 col-md-2">
      <label class="form-label">Mes</label>
      <input id="month" type="number" class="form-control" placeholder="1-12">
    </div>
    <div class="col-6 col-md-2">
      <label class="form-label">Semana ISO</label>
      <input id="week" type="number" class="form-control" placeholder="1-53">
    </div>
    <div class="col-6 col-md-3">
      <label class="form-label">Día</label>
      <input id="day" type="date" class="form-control">
    </div>
    <div class="col-6 col-md-1">
      <label class="form-label">Tipo</label>
      <select id="type" class="form-select">
        <option value="">Todos</option>
        <option value="debito">Débito</option>
        <option value="credito">Crédito</option>
        <option value="transferencia">Transferencia</option>
      </select>
    </div>
    <div class="col-6 col-md-2">
      <label class="form-label">Categoría</label>
      <input id="category" class="form-control" placeholder="todas">
    </div>
    <div class="col-12 col-md-3">
      <label class="form-label">Buscar</label>
      <input id="q" class="form-control" placeholder="texto libre">
    </div>
    <div class="col-12 col-md-2 ms-auto">
      <button id="resetFilters" class="btn btn-secondary w-100">Reset filtros</button>
    </div>
  </div>

  <!-- Resumen -->
  <div class="row g-3 mb-4">
    <div class="col-12 col-md-4 offset-md-4">
      <div class="card shadow-sm">
        <div class="card-body text-center">
          <h5 class="card-title">Gasto total</h5>
          <div id="total" class="display-6">$0</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Gráficos alineados y del mismo tamaño -->
  <div class="row g-3 mb-4 align-items-stretch">
    <div class="col-12 col-xl-6">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h5 class="card-title">Gasto por categoría (barras)</h5>
          <div class="chart-container">
            <canvas id="catChart"></canvas>
          </div>
        </div>
      </div>
    </div>
    <div class="col-12 col-xl-6">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h5 class="card-title">Distribución por categoría (torta)</h5>
          <div class="chart-container">
            <canvas id="pieChart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Leyenda a ancho completo -->
  <div class="row g-3 mb-4">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title">Leyenda</h5>
          <div id="legend" class="d-flex flex-column gap-2"></div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/dashboard.js') }}" defer></script>
{% endblock %}
